<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Whoâ€™s the Gekon? â€“ Mobilna wersja</title>
  <link rel="stylesheet" href="/static/mobi.css" />
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Whoâ€™s the Gekon?</h1>

    <div id="status">Oczekiwanie...</div>
    <div id="role"></div>
    <div id="timer"></div>

    <div class="btn-grid">
      <button id="joinBtn" class="game-btn orange">DoÅ‚Ä…cz do gry</button>
      <button id="startBtn" class="game-btn blue">Start gry</button>
      <button id="restartBtn" class="game-btn red">Restart/Koniec</button>
      <button id="nextBtn" class="game-btn green">NastÄ™pna runda</button>
    </div>

    <div class="big-btn">
      <button id="stopBtn" class="stop-button">DUÅ»Y PRZYCISK</button>
    </div>
  </div>

  <script>

 
    const socket = io();
    let myId = "";
// ---- POKAZYWANIE / CHOWANIE PRZYCISKÃ“W ----
function showBeforeStart() {
    document.getElementById("joinBtn").style.display    = "inline-block";
    document.getElementById("startBtn").style.display   = "inline-block";
    document.getElementById("restartBtn").style.display = "inline-block";
    document.getElementById("nextBtn").style.display    = "none";
    document.getElementById("stopBtn").style.display    = "none";
  }

  function showAfterStart() {
    document.getElementById("joinBtn").style.display    = "none";
    document.getElementById("startBtn").style.display   = "none";
    document.getElementById("restartBtn").style.display = "inline-block"; // jeÅ›li chcesz ukryÄ‡, zmieÅ„ na "none"
    document.getElementById("nextBtn").style.display    = "inline-block";
    document.getElementById("stopBtn").style.display    = "inline-block";
  }

  // startowy ukÅ‚ad
  showBeforeStart();

  // ---- HANDLERY KLIKÃ“W ----
  document.getElementById("joinBtn").onclick = () => {
    const name = prompt("Podaj swoje imiÄ™:");
    if (!name || name.trim() === "") return alert("Musisz wpisaÄ‡ imiÄ™!");
    myId = name.trim();
    socket.emit("join", { id: myId });
  };

  document.getElementById("startBtn").onclick = () => {
    socket.emit("start");
    // ukÅ‚ad przeÅ‚Ä…czy siÄ™ po komunikacie z serwera (patrz niÅ¼ej)
  };

  document.getElementById("nextBtn").onclick = () => {
    socket.emit("next_round");
  };

  document.getElementById("restartBtn").onclick = () => {
    socket.emit("restart");
    // ukÅ‚ad przeÅ‚Ä…czy siÄ™ po "clear"/"Gra zresetowana"
  };

  document.getElementById("stopBtn").onclick = () => {
    if (!myId) return alert("Najpierw doÅ‚Ä…cz do gry!");
    socket.emit("pause", { id: myId });
  };

  // ---- ODBIÃ“R ZDARZEÅƒ Z SERWERA ----
  socket.on("joined", data => {
    document.getElementById("status").innerText = data.msg;
  });

  socket.on("info", data => {
    const msg = data.msg || "";
    document.getElementById("status").innerText = msg;

    // PrzeÅ‚Ä…cz ukÅ‚ad na podstawie komunikatÃ³w
    if (msg.startsWith("Gra rozpoczÄ™ta!")) {
      showAfterStart();
    } else if (msg.startsWith("Nowa runda!")) {
      showAfterStart();
    } else if (msg.toLowerCase().includes("zresetowana")) {
      showBeforeStart();
    }
  });

  socket.on("error", data => {
    alert(data.msg);
  });

  socket.on("role", data => {
    const { category, secret, runda } = data;
    if (secret) {
      document.getElementById("role").innerText =
        `Runda ${runda}\nâœ… Gracz\nKategoria: ${category}\nHasÅ‚o: ${secret}`;
    } else {
      document.getElementById("role").innerText =
        `Runda ${runda}\nðŸ•µï¸â€â™‚ï¸ SZPIEG\nKategoria: ${category}`;
    }
    // na wszelki wypadek (gdyby info przyszÅ‚o pÃ³Åºniej)
    showAfterStart();
  });

  socket.on("timer", data => {
    const t = data.time;
    document.getElementById("timer").innerText = (t === "" || t == null) ? "" : `â³ ${t}s`;
  });

  socket.on("paused", data => {
    document.getElementById("status").innerText =(data.msg || "");
  });

  socket.on("clear", () => {
    document.getElementById("role").innerText = "";
    document.getElementById("timer").innerText = "";
    document.getElementById("status").innerText = "Oczekiwanie...";
    showBeforeStart();

  
  });



socket.on("boom", data => {

  if (navigator.vibrate)
   navigator.vibrate(900/2)
 document.body.classList.add("boomFX");
  setTimeout(() => {
    document.body.classList.remove("boomFX");
  }, 3000); // wraca do normalnego
})
socket.on("end", data => {

  if (navigator.vibrate)
   navigator.vibrate(900/2)
 document.body.classList.add("end");
  setTimeout(() => {
    document.body.classList.remove("end");
  }, 300);
})
</script>

</body>
</html>